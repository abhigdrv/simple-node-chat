<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <div class="header">
        <h3>Online Users:</h3>
        <p style="font-size: 14px;"><span id="user-list"></span></p>
    </div>
    <div class="chat-box" id="chat-box"></div>
    <div class="input-box">
        <span class="letter-icon">&#9993;</span>
        <input type="text" id="message-input" placeholder="Type your message..." style="display: none;">
        <button id="send-btn" style="display: none;" onclick="sendMessage()">Send</button>

        <input type="text" id="username-input" placeholder="Type your username...">
        <button id="login-btn" onclick="setUsername()">Login</button>
    </div>
</div>

<script>
    document.getElementById("message-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            document.getElementById("send-btn").click();
        }
    });
    document.getElementById("username-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            document.getElementById("login-btn").click();
        }
    });
</script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  const socket = io();
  function setUsername() {
    const usernameInput = document.getElementById('username-input');
    const messageInput = document.getElementById('message-input');
    const setButton = document.getElementById('login-btn');
    const sendButton = document.getElementById('send-btn');
    const randomNumber = Math.floor(Math.random() * 900) + 100;
    const username = usernameInput.value.trim()+"_"+randomNumber;
    if (username !== '') {
      socket.emit('setUsername', username);
      usernameInput.style.display = 'none';
      messageInput.style.display = 'block';
      setButton.style.display = 'none';
      sendButton.style.display = 'block';
    }
  }

  function sendMessage() {
    const messageInput = document.getElementById('message-input');
    const message = messageInput.value.trim();
    if (message !== '') {
      socket.emit('chat message', message);
      messageInput.value = '';
    }
  }

  socket.on('userList', (users) => {
    const userList = document.getElementById('user-list');
    userList.innerHTML = users.join(', ');
  });

  socket.on('chat message', (data) => {
    const chatBox = document.getElementById('chat-box');
    const messageElement = document.createElement('p');
    console.log(generateColorHash(data.username));
    messageElement.style.backgroundColor = generateColorHash(data.username);
    messageElement.innerHTML = `<strong>${data.username}:</strong> ${data.msg}`;
    chatBox.appendChild(messageElement);
    chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to the bottom
  });
  function generateColorHash(name) {
        let hashCode = 0;
        for (let i = 0; i < name.length; i++) {
            hashCode = name.charCodeAt(i) + ((hashCode << 5) - hashCode);
        }
        let color = '#';
        for (let i = 0; i < 6; i++) {
            const value = (hashCode >> (i * 4)) & 0xFF;
            color += value.toString(16).padStart(2, '0');
        }
        color += '80';
        return color.substring(0, 7)+"50";
    }
</script>
</body>
</html>
